<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø¬Ù†Ú¯ Ù‡ÙˆØ§ÛŒÛŒ Ø¹Ù…ÙˆØ¯ÛŒ</title>
<style>
    body { margin:0; overflow:hidden; font-family:sans-serif; background:#111; }
    canvas { display:block; margin:0 auto; }
    .btn { position:fixed; bottom:20px; width:60px; height:60px; border-radius:50%; background:rgba(255,0,0,0.8); color:white; font-size:30px; text-align:center; line-height:60px; user-select:none; z-index:10; }
    #btnLeft { left:20px; }
    #btnRight { left:100px; }
    #shootBtn { right:20px; bottom:20px; }
    #loadingScreen {
        position:fixed; top:0; left:0; width:100%; height:100%; background:#111; color:white;
        display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:20px; z-index:100;
    }
    #startBtn {
        margin-top:20px; padding:10px 20px; font-size:18px; background:#f00; border:none; color:white; border-radius:5px; display:none;
    }
</style>
</head>
<body>

<div id="loadingScreen">
    <div>Ù„Ø·ÙØ§ Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...</div>
    <button id="startBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
</div>

<canvas id="game"></canvas>
<div class="btn" id="btnLeft">â—€</div>
<div class="btn" id="btnRight">â–¶</div>
<div class="btn" id="shootBtn">ğŸ”«</div>

<script>
// Canvas
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ØªØµØ§ÙˆÛŒØ± Ùˆ ØµØ¯Ø§Ù‡Ø§
let bgImg = new Image(); bgImg.src = 'assets/BackGround.png';
let playerImg = new Image(); playerImg.src = 'assets/player.png';
let enemyImg = new Image(); enemyImg.src = 'assets/Enemy.png';
let bulletImg = new Image(); bulletImg.src = 'assets/Bullet.png';
let boomImg = new Image(); boomImg.src = 'assets/BOOM.png';
let gunSound = new Audio('assets/gun.mp3');

// Ø¨Ø§Ø²ÛŒÚ©Ù†
let player = { x:canvas.width/2, y:canvas.height-200, w:100, h:100, speed:6, lives:5 };

// Ú¯Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§
let bullets=[], enemies=[], explosions=[], enemyBullets=[];
let score=0, startTime=0, lastDifficultyTime=0, enemyShotEnable=false, enemiesPassed=0;

// Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
let moveLeft=false, moveRight=false;

// Ø´Ù„ÛŒÚ© Ø¨Ø§Ø²ÛŒÚ©Ù†
function shoot(){ bullets.push({x:player.x+player.w/2-10,y:player.y-20,w:20,h:20,speed:10}); gunSound.currentTime=0; gunSound.play(); }

// Ú©Ù†ØªØ±Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
document.getElementById("btnLeft").addEventListener("touchstart", ()=>moveLeft=true);
document.getElementById("btnLeft").addEventListener("touchend", ()=>moveLeft=false);
document.getElementById("btnRight").addEventListener("touchstart", ()=>moveRight=true);
document.getElementById("btnRight").addEventListener("touchend", ()=>moveRight=false);
document.getElementById("shootBtn").addEventListener("touchstart", shoot);

// Ù„ÙˆØ¯ÛŒÙ†Ú¯
const loadingScreen = document.getElementById('loadingScreen');
const startBtn = document.getElementById('startBtn');
setTimeout(()=>{ startBtn.style.display='block'; },5000);
startBtn.addEventListener('click', ()=>{
    loadingScreen.style.display='none';
    startTime = Date.now();
    update();
});

// Ø³Ø§Ø®Øª Ø¯Ø´Ù…Ù†
let enemySpeedBase = 2;
let enemyCountBase = 1;
function spawnEnemy(){ 
    for(let i=0;i<enemyCountBase;i++){
        let size=80;
        enemies.push({x:Math.random()*(canvas.width-size), y:-size, w:size, h:size, speed:enemySpeedBase + Math.random()*2});
    }
}

// Ø´Ù„ÛŒÚ© Ø¯Ø´Ù…Ù†
function enemyShoot(enemy){
    enemyBullets.push({x:enemy.x+enemy.w/2-5, y:enemy.y+enemy.h, w:10, h:20, speed:6});
}

// Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø§Ø²ÛŒ
let frame=0;
function update(){
    frame++;
    if(frame%100===0) spawnEnemy();

    // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø®ØªÛŒ Ù‡Ø± 10 Ø«Ø§Ù†ÛŒÙ‡
    if(startTime){
        let elapsed = (Date.now() - startTime)/1000;
        if(elapsed - lastDifficultyTime >= 10){
            enemySpeedBase += 0.5;
            enemyCountBase += 1;
            lastDifficultyTime = elapsed;
            enemyShotEnable = true; // Ø¨Ø¹Ø¯ Ø§Ø² 10 Ø«Ø§Ù†ÛŒÙ‡ Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§ Ø´Ù„ÛŒÚ© Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
        }
    }
    // Ø­Ø±Ú©Øª Ø¨Ø§Ø²ÛŒÚ©Ù†
    if(moveLeft) player.x-=player.speed;
    if(moveRight) player.x+=player.speed;
    if(player.x<0) player.x=0; 
    if(player.x+player.w>canvas.width) player.x=canvas.width-player.w;

    // Ø­Ø±Ú©Øª Ú¯Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§
    bullets.forEach((b,i)=>{ b.y-=b.speed; if(b.y+b.h<0) bullets.splice(i,1); });

    // Ø­Ø±Ú©Øª Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§
    enemies.forEach((en,i)=>{
        en.y+=en.speed;

        // Ø§Ú¯Ø± Ø§Ø² Ø®Ø· Ù¾Ø´Øª Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¹Ø¨ÙˆØ± Ú©Ø±Ø¯
        if(en.y + en.h > player.y+player.h+50){ // 50 Ù¾ÛŒÚ©Ø³Ù„ Ø¹Ù‚Ø¨â€ŒØªØ±
            enemiesPassed++;
            enemies.splice(i,1);
            if(enemiesPassed>=3){ alert("Ø¨Ø§Ø®ØªÛŒ! Ø§Ù…ØªÛŒØ§Ø²: "+score); document.location.reload(); }
            return;
        }

        // Ø´Ù„ÛŒÚ© Ø¯Ø´Ù…Ù†
        if(enemyShotEnable && Math.random()<0.01){ enemyShoot(en); }

        // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ú¯Ù„ÙˆÙ„Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø§ Ø¯Ø´Ù…Ù†
        bullets.forEach((b,j)=>{
            if(b.x<en.x+en.w && b.x+b.w>en.x && b.y<en.y+en.h && b.y+b.h>en.y){
                explosions.push({x:en.x,y:en.y,w:en.w,h:en.h,frame:0});
                enemies.splice(i,1); bullets.splice(j,1); score++;
            }
        });

        // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø¨Ø§Ø²ÛŒÚ©Ù† ØªÙˆØ³Ø· Ø¯Ø´Ù…Ù†
        enemyBullets.forEach((eb,k)=>{
            if(eb.x<player.x+player.w && eb.x+eb.w>player.x && eb.y<player.y+player.h && eb.y+eb.h>player.y){
                player.lives--;
                enemyBullets.splice(k,1);
                if(player.lives<=0){ alert("Ø¨Ø§Ø®ØªÛŒ! Ø§Ù…ØªÛŒØ§Ø²: "+score); document.location.reload(); }
            }
        });
    });

    // Ø­Ø±Ú©Øª Ú¯Ù„ÙˆÙ„Ù‡ Ø¯Ø´Ù…Ù†
    enemyBullets.forEach((eb,i)=>{ eb.y+=eb.speed; if(eb.y>canvas.height) enemyBullets.splice(i,1); });

    // Ø§Ù†ÙØ¬Ø§Ø±
    explosions.forEach((ex,i)=>{ ex.frame++; if(ex.frame>20) explosions.splice(i,1); });

    draw();
    requestAnimationFrame(update);
}

// Ø±Ø³Ù…
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

    // Ø®Ø· Ú†ÛŒÙ† Ù¾Ø´Øª Ø¨Ø§Ø²ÛŒÚ©Ù† (Ø­Ø±ÛŒÙ…)
    ctx.strokeStyle="yellow";
    ctx.setLineDash([5,5]);
    ctx.strokeRect(player.x-50, player.y+player.h+50, player.w+100, 20);
    ctx.setLineDash([]);

    // Ø¨Ø§Ø²ÛŒÚ©Ù†
    ctx.save();
    ctx.translate(player.x+player.w/2,player.y+player.h/2);
    ctx.rotate(-Math.PI/2);
    ctx.drawImage(playerImg,-player.w/2,-player.h/2,player.w,player.h);
    ctx.restore();

    // Ú¯Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§
    bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,b.w,b.h));
    enemyBullets.forEach(eb=>{
        ctx.fillStyle="red"; ctx.fillRect(eb.x,eb.y,eb.w,eb.h);
    });

    // Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§
    enemies.forEach(en=>ctx.drawImage(enemyImg,en.x,en.y,en.w,en.h));

    // Ø§Ù†ÙØ¬Ø§Ø±
    explosions.forEach(ex=>ctx.drawImage(boomImg,ex.x,ex.y,ex.w,ex.h));

    // Ø§Ù…ØªÛŒØ§Ø²
    ctx.fillStyle="#fff"; ctx.font="20px Arial"; ctx.fillText("Score: "+score,10,30);

    // Ø¬Ø§Ù†â€ŒÙ‡Ø§
    for(let i=0;i<5;i++){
        ctx.fillStyle = i<player.lives?"red":"black";
        ctx.fillRect(10+i*25,50,20,20);
    }
}

</script>

</body>
</html>
