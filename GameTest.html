<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AlonePilot</title>
<style>
body { margin:0; overflow:hidden; font-family:sans-serif; background:#111; }
canvas { display:block; margin:0 auto; }
.btn { position:fixed; bottom:20px; width:80px; height:80px; border-radius:50%; 
      background:rgba(255,0,0,0.6); color:white; font-size:36px; text-align:center; 
      line-height:80px; user-select:none; z-index:10; border:none; }
#btnLeft { left:20px; }
#btnRight { left:120px; }
#shootBtn { right:20px; bottom:20px; }
#loadingScreen {
    position:fixed; top:0; left:0; width:100%; height:100%; background:#111; color:white;
    display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:20px; z-index:100;
    text-align:center;
}
#startBtn {
    margin-top:20px; padding:10px 20px; font-size:18px; background:#f00; border:none; color:white; border-radius:5px;
}
#poweredBy {
    position:fixed; bottom:5px; right:10px; color:white; font-size:14px; font-family:sans-serif;
}
</style>
</head>
<body>

<div id="loadingScreen">
    <div>Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø®Ù„Ø¨Ø§Ù† ØªÙ†Ù‡Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</div>
    <div>Ù„Ø·ÙØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯</div>
    <button id="startBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
</div>

<canvas id="game"></canvas>
<div class="btn" id="btnLeft">â—€</div>
<div class="btn" id="btnRight">â–¶</div>
<div class="btn" id="shootBtn">ğŸ”«</div>
<div id="poweredBy">powered by Floki â¤ï¸</div>

<script>
// Canvas
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener('resize', ()=>{ canvas.width=window.innerWidth; canvas.height=window.innerHeight; });

// ØªØµØ§ÙˆÛŒØ±
let bgImg = new Image(); bgImg.src='assets/BackGround.png';
let playerImg = new Image(); playerImg.src='assets/player.png';
let enemyImg = new Image(); enemyImg.src='assets/Enemy.png';
let bulletImg = new Image(); bulletImg.src='assets/Bullet.png';
let boomImg = new Image(); boomImg.src='assets/BOOM.png';

// Pool ØµØ¯Ø§Ù‡Ø§
function createSoundPool(src,count=5){ let pool=[]; for(let i=0;i<count;i++) pool.push(new Audio(src)); return pool;}
let gunPool=createSoundPool('assets/gun.mp3'); let burstPool=createSoundPool('assets/burst.mp3'); let bombPool=createSoundPool('assets/bomb.mp3');
function playSound(pool){ for(let s of pool){ if(s.paused){ s.currentTime=0; s.play(); return; }}}
let bgMusic = new Audio('assets/zamine.mp3'); bgMusic.loop=true; bgMusic.volume=0.5;

// Ø¨Ø§Ø²ÛŒÚ©Ù†
let player = { x:canvas.width/2, y:canvas.height-200, w:100, h:100, speed:6, lives:5 };

// Ú¯Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§
let bullets=[], enemies=[], explosions=[], enemyBullets=[];
let score=0, startTime=0, lastDifficultyTime=0, enemyShotEnable=false;
let frame=0, enemiesPassed=0, gameStarted=false;

// Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
let moveLeft=false, moveRight=false;
function shoot(){ bullets.push({x:player.x+player.w/2-10,y:player.y-20,w:20,h:20,speed:10}); playSound(gunPool); }
document.getElementById("btnLeft").addEventListener("touchstart", ()=>moveLeft=true);
document.getElementById("btnLeft").addEventListener("touchend", ()=>moveLeft=false);
document.getElementById("btnRight").addEventListener("touchstart", ()=>moveRight=true);
document.getElementById("btnRight").addEventListener("touchend", ()=>moveRight=false);
document.getElementById("shootBtn").addEventListener("touchstart", shoot);

// Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹
const loadingScreen = document.getElementById('loadingScreen');
const startBtn = document.getElementById('startBtn');
startBtn.addEventListener('click', ()=>{ loadingScreen.style.display='none'; startGame(); });

// Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
let enemySpeedBase=2, enemyCountBase=1;
function startGame(){
    startTime=Date.now(); frame=0; lastDifficultyTime=0; enemySpeedBase=2; enemyCountBase=1; enemyShotEnable=false;
    player.lives=5; player.x=canvas.width/2; bullets=[]; enemies=[]; enemyBullets=[]; explosions=[]; enemiesPassed=0; score=0;
    gameStarted=true;
    bgMusic.currentTime=0; bgMusic.play();
    requestAnimationFrame(update);
}

// Ø¯Ø´Ù…Ù†
function spawnEnemy(){ 
    for(let i=0;i<enemyCountBase;i++){
        let size=80;
        enemies.push({x:Math.random()*(canvas.width-size),y:-size,w:size,h:size,speed:enemySpeedBase+Math.random()*2,shotsFired:0,maxShots:Math.floor(Math.random()*2)+1});
    }
}
function enemyShoot(enemy){ enemyBullets.push({x:enemy.x+enemy.w/2-5,y:enemy.y+enemy.h,w:10,h:20,speed:6}); playSound(burstPool); }

// Ø¢Ù¾Ø¯ÛŒØª
function update(){
    if(!gameStarted) return;
    frame++; if(frame%100===0) spawnEnemy();
    if(startTime){
        let elapsed=(Date.now()-startTime)/1000;
        if((elapsed>0 && elapsed<=10) && lastDifficultyTime==0){enemySpeedBase+=0.5; enemyCountBase++; lastDifficultyTime=1;}
        else if((elapsed>10 && elapsed<=30) && lastDifficultyTime==1){enemySpeedBase+=0.5; enemyCountBase++; lastDifficultyTime=2;}
        else if(elapsed>30 && Math.floor(elapsed/10)+1>lastDifficultyTime){enemySpeedBase+=0.5; enemyCountBase++; lastDifficultyTime=Math.floor(elapsed/10)+1;}
        if(elapsed>10) enemyShotEnable=true;
    }

    if(moveLeft) player.x-=player.speed;
    if(moveRight) player.x+=player.speed;
    if(player.x<0) player.x=0; if(player.x+player.w>canvas.width) player.x=canvas.width-player.w;

    bullets.forEach((b,bi)=>{
        b.y-=b.speed;
        for(let ei=enemyBullets.length-1;ei>=0;ei--){
            let eb=enemyBullets[ei];
            if(b.x<eb.x+eb.w && b.x+b.w>eb.x && b.y<eb.y+eb.h && b.y+b.h>eb.y){ bullets.splice(bi,1); enemyBullets.splice(ei,1); playSound(bombPool); return; }
        }
        if(b.y+b.h<0) bullets.splice(bi,1);
    });

    for(let i=enemies.length-1;i>=0;i--){
        let en=enemies[i]; en.y+=en.speed;
        if(en.y+en.h>player.y+player.h+50){ enemiesPassed++; enemies.splice(i,1);
            if(enemiesPassed>=3){ endGame(); } continue; }
        if(en.x<player.x+player.w && en.x+en.w>player.x && en.y<player.y+player.h && en.y+en.h>player.y){ player.lives--; enemies.splice(i,1);
            if(player.lives<=0){ endGame(); } continue; }
        for(let j=bullets.length-1;j>=0;j--){
            let b=bullets[j];
            if(b.x<en.x+en.w && b.x+b.w>en.x && b.y<en.y+en.h && b.y+b.h>en.y){ explosions.push({x:en.x,y:en.y,w:en.w,h:en.h,frame:0}); enemies.splice(i,1); bullets.splice(j,1); playSound(bombPool); score++; break; }
        }
        if(enemyShotEnable && en.shotsFired<en.maxShots && Math.random()<0.01 && en.y<player.y+player.h-100){ enemyShoot(en); en.shotsFired++; }
    }

    for(let i=enemyBullets.length-1;i>=0;i--){
        let eb=enemyBullets[i]; eb.y+=eb.speed;
        if(eb.y>canvas.height){enemyBullets.splice(i,1); continue;}
        if(eb.x<player.x+player.w && eb.x+eb.w>player.x && eb.y<player.y+player.h && eb.y+eb.h>player.y){ player.lives--; enemyBullets.splice(i,1);
            if(player.lives<=0){ endGame(); }
        }
    }

    for(let i=explosions.length-1;i>=0;i++){ explosions[i].frame++; if(explosions[i].frame>20) explosions.splice(i,1); }

    draw();
    if(gameStarted) requestAnimationFrame(update);
}

function endGame(){
    gameStarted=false;
    loadingScreen.style.display='flex';
    loadingScreen.querySelector('#loadingText')?.remove();
    const textDiv = document.createElement('div');
    textDiv.id='loadingText';
    textDiv.innerText=Ø¨Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯\nØ§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${score};
    loadingScreen.insertBefore(textDiv,startBtn);
}

// Ø±Ø³Ù…
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
    ctx.strokeStyle="yellow"; ctx.setLineDash([5,5]); ctx.strokeRect(0,player.y+player.h+50,canvas.width,20); ctx.setLineDash([]);ctx.save(); ctx.translate(player.x+player.w/2,player.y+player.h/2); ctx.rotate(-Math.PI/2); ctx.drawImage(playerImg,-player.w/2,-player.h/2,player.w,player.h); ctx.restore();
    bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,b.w,b.h));
    enemyBullets.forEach(eb=>{ctx.fillStyle="red";ctx.fillRect(eb.x,eb.y,eb.w,eb.h);});
    enemies.forEach(en=>ctx.drawImage(enemyImg,en.x,en.y,en.w,en.h));
    explosions.forEach(ex=>ctx.drawImage(boomImg,ex.x,ex.y,ex.w,ex.h));
    ctx.fillStyle="#fff"; ctx.font="20px Arial"; ctx.fillText("Score: "+score,10,30);
    for(let i=0;i<5;i++){ ctx.fillStyle=i<player.lives?"red":"black"; ctx.fillRect(10+i*25,50,20,20); }
}
</script>
</body>
</html>
